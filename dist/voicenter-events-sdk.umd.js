!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("socket.io-client/socket.io")):"function"==typeof define&&define.amd?define(["socket.io-client/socket.io"],e):(t=t||self).VoicenterEventsSDK=e(t.io)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var n,o=(function(t){var e=function(t){var e,n=Object.prototype,o=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(t,e,n,o){var r=e&&e.prototype instanceof y?e:y,i=Object.create(r.prototype),c=new T(o||[]);return i._invoke=function(t,e,n){var o=l;return function(r,i){if(o===f)throw new Error("Generator is already running");if(o===v){if("throw"===r)throw i;return L()}for(n.method=r,n.arg=i;;){var c=n.delegate;if(c){var s=w(c,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var a=u(t,e,n);if("normal"===a.type){if(o=n.done?v:h,a.arg===p)continue;return{value:a.arg,done:n.done}}"throw"===a.type&&(o=v,n.method="throw",n.arg=a.arg)}}}(t,n,c),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=a;var l="suspendedStart",h="suspendedYield",f="executing",v="completed",p={};function y(){}function d(){}function g(){}var E={};E[i]=function(){return this};var m=Object.getPrototypeOf,_=m&&m(m(x([])));_&&_!==n&&o.call(_,i)&&(E=_);var k=g.prototype=y.prototype=Object.create(E);function O(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function b(t){var e;this._invoke=function(n,r){function i(){return new Promise(function(e,i){!function e(n,r,i,c){var s=u(t[n],t,r);if("throw"!==s.type){var a=s.arg,l=a.value;return l&&"object"==typeof l&&o.call(l,"__await")?Promise.resolve(l.__await).then(function(t){e("next",t,i,c)},function(t){e("throw",t,i,c)}):Promise.resolve(l).then(function(t){a.value=t,i(a)},function(t){return e("throw",t,i,c)})}c(s.arg)}(n,r,e,i)})}return e=e?e.then(i,i):i()}}function w(t,n){var o=t.iterator[n.method];if(o===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,w(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=u(o,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;var i=r.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function x(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,c=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return c.next=c}}return{next:L}}function L(){return{value:e,done:!0}}return d.prototype=k.constructor=g,g.constructor=d,g[s]=d.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},O(b.prototype),b.prototype[c]=function(){return this},t.AsyncIterator=b,t.async=function(e,n,o,r){var i=new b(a(e,n,o,r));return t.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},O(k),k[s]="Generator",k[i]=function(){return this},k.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var o=e.pop();if(o in t)return n.value=o,n.done=!1,n}return n.done=!0,n}},t.values=x,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(o,r){return s.type="throw",s.arg=t,n.next=o,r&&(n.method="next",n.arg=e),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var c=this.tryEntries[i],s=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var a=o.call(c,"catchLoc"),u=o.call(c,"finallyLoc");if(a&&u){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(a){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var c=i?i.completion:{};return c.type=t,c.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(c)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var o=n.completion;if("throw"===o.type){var r=o.arg;N(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:x(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),p}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}(n={exports:{}},n.exports),n.exports);function r(t,e,n,o,r,i,c){try{var s=t[i](c),a=s.value}catch(t){return void n(t)}s.done?e(a):Promise.resolve(a).then(o,r)}function i(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var c=t.apply(e,n);function s(t){r(c,o,i,s,a,"next",t)}function a(t){r(c,o,i,s,a,"throw",t)}s(void 0)})}}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){u(t,e,n[e])})}return t}var h={LOGIN:"loginStatus",LOGIN_RESPONSE:"loginResponse",QUEUE_EVENT:"QueueEvent",EXTENSION_EVENT:"ExtensionEvent",ALL_EXTENSION_STATUS:"AllExtensionsStatus",CONNECT_ERROR:"connect_error",CONNECT_TIMEOUT:"connect_timeout",DISCONNECT:"disconnect",RECONNECT:"reconnect",RECONNECT_ATTEMPT:"reconnect_attempt",RECONNECTING:"reconnecting",RECONNECT_ERROR:"reconnect_error",RECONNECT_FAILED:"reconnect_failed",KEEP_ALIVE:"keepalive",KEEP_ALIVE_RESPONSE:"keepaliveResponse",CLOSE:"closeme",ERROR:"error"},f=[{URLID:59,Priority:5,Version:2,Domain:"monitor1.voicenter.co"},{URLID:3,Priority:4,Version:2,Domain:"monitor3.voicenter.co.il"},{URLID:4,Priority:3,Version:2,Domain:"monitor4.voicenter.co.il"},{URLID:11,Priority:2,Version:2,Domain:"monitor11.voicenter.co"},{URLID:5,Priority:0,Version:2,Domain:"monitor5.voicenter.co.il"}],v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,t),this.debug=e.debug}return a(t,[{key:"_log",value:function(t,e){var n=e?"".concat(t,", %c Data -> ").concat(JSON.stringify(e)):"".concat(t),o=(new Date).toUTCString();console.log("%c ".concat(o,": %c ").concat(n),"color: #276749;","color: #4299e1;","color: #2c3e50;")}},{key:"_error",value:function(t,e){var n=e?"".concat(t,", Data -> ").concat(JSON.stringify(e)):"".concat(t),o=(new Date).toUTCString();console.error("".concat(o,": ").concat(n))}},{key:"log",value:function(t,e){this.debug&&(t&&!e?this._log(t):this._log(t,e))}},{key:"error",value:function(t,e){this.debug&&(t&&!e?this._error(t):this._error(t,e))}}]),t}();var p=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},y="object"==typeof e&&e&&e.Object===Object&&e,d="object"==typeof self&&self&&self.Object===Object&&self,g=y||d||Function("return this")(),E=function(){return g.Date.now()},m=g.Symbol,_=Object.prototype,k=_.hasOwnProperty,O=_.toString,b=m?m.toStringTag:void 0;var w=function(t){var e=k.call(t,b),n=t[b];try{t[b]=void 0;var o=!0}catch(t){}var r=O.call(t);return o&&(e?t[b]=n:delete t[b]),r},C=Object.prototype.toString;var N=function(t){return C.call(t)},T="[object Null]",x="[object Undefined]",L=m?m.toStringTag:void 0;var R=function(t){return null==t?void 0===t?x:T:L&&L in Object(t)?w(t):N(t)};var S=function(t){return null!=t&&"object"==typeof t},D="[object Symbol]";var P=function(t){return"symbol"==typeof t||S(t)&&R(t)==D},I=NaN,j=/^\s+|\s+$/g,A=/^[-+]0x[0-9a-f]+$/i,M=/^0b[01]+$/i,F=/^0o[0-7]+$/i,U=parseInt;var V=function(t){if("number"==typeof t)return t;if(P(t))return I;if(p(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=p(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(j,"");var n=M.test(t);return n||F.test(t)?U(t.slice(2),n?2:8):A.test(t)?I:+t},G="Expected a function",K=Math.max,$=Math.min;var J=function(t,e,n){var o,r,i,c,s,a,u=0,l=!1,h=!1,f=!0;if("function"!=typeof t)throw new TypeError(G);function v(e){var n=o,i=r;return o=r=void 0,u=e,c=t.apply(i,n)}function y(t){var n=t-a;return void 0===a||n>=e||n<0||h&&t-u>=i}function d(){var t=E();if(y(t))return g(t);s=setTimeout(d,function(t){var n=e-(t-a);return h?$(n,i-(t-u)):n}(t))}function g(t){return s=void 0,f&&o?v(t):(o=r=void 0,c)}function m(){var t=E(),n=y(t);if(o=arguments,r=this,a=t,n){if(void 0===s)return function(t){return u=t,s=setTimeout(d,e),l?v(t):c}(a);if(h)return clearTimeout(s),s=setTimeout(d,e),v(a)}return void 0===s&&(s=setTimeout(d,e)),c}return e=V(e)||0,p(n)&&(l=!!n.leading,i=(h="maxWait"in n)?K(V(n.maxWait)||0,e):i,f="trailing"in n?!!n.trailing:f),m.cancel=function(){void 0!==s&&clearTimeout(s),u=0,o=a=r=s=void 0},m.flush=function(){return void 0===s?c:g(E())},m};var Q={url:"https://monitorapi.voicenter.co.il/monitorAPI/getMonitorUrls",token:null,forceNew:!1,reconnectionDelay:1e4,reconnectionDelayMax:1e4,timeout:1e4,keepAliveTimeout:6e4,protocol:"https",transports:["websocket"],upgrade:!1},W=[],X=new Map,Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(c(this,e),this.options=l({},Q,t),!this.options.token)throw new Error("A token property should be provided");this.Logger=new v(this.options),this.servers=[],this.server=null,this.socket=null,this.connected=!1,this.connections=W,this.connectionEstablished=!1,this.shouldReconnect=!0,this._initReconnectOptions(),this._listenersMap=X,this._retryConnection=J(this._connect.bind(this),this.reconnectOptions.reconnectionDelay,{leading:!0,trailing:!1})}return a(e,[{key:"_initReconnectOptions",value:function(){this.reconnectOptions={retryCount:1,reconnectionDelay:this.options.reconnectionDelay,minReconnectionDelay:this.options.reconnectionDelay,maxReconnectionDelay:3e5}}},{key:"_onConnect",value:function(){this._initReconnectDelays(),this.connected=!0,this.Logger.log(h.CONNECT,this.reconnectOptions)}},{key:"_initReconnectDelays",value:function(){this.reconnectOptions.retryCount=1;var t=this.reconnectOptions.minReconnectionDelay;this.reconnectOptions.reconnectionDelay=t,this.socket.io.reconnectionDelay(t),this.socket.io.reconnectionDelayMax(t)}},{key:"_onConnectError",value:function(t){this._retryConnection("next"),this.connected=!1,this.Logger.log(h.CONNECT_ERROR,t)}},{key:"_onReconnectFailed",value:function(){this._retryConnection("next"),this.Logger.log(h.RECONNECT_FAILED,this.reconnectOptions)}},{key:"_onConnectTimeout",value:function(){this._retryConnection("next"),this.Logger.log(h.CONNECT_TIMEOUT,this.reconnectOptions)}},{key:"_onReconnectAttempt",value:function(t){if(t>2)this._retryConnection("next");else{if(this.reconnectOptions.reconnectionDelay<this.reconnectOptions.maxReconnectionDelay){var e=this.reconnectOptions.minReconnectionDelay*this.reconnectOptions.retryCount;this.reconnectOptions.reconnectionDelay=e,this.socket.io.reconnectionDelay(e),this.socket.io.reconnectionDelayMax(e)}this.reconnectOptions.retryCount++,this.Logger.log(h.RECONNECT_ATTEMPT,this.reconnectOptions)}}},{key:"_onDisconnect",value:function(){this.shouldReconnect&&this._connect("next"),this.connected=!1,this.Logger.log(h.DISCONNECT,this.reconnectOptions)}},{key:"_onKeepAlive",value:function(t){!1===t&&this.connected&&(this._initSocketConnection(),this.Logger.log(h.KEEP_ALIVE_RESPONSE,this.reconnectOptions))}},{key:"_parsePacket",value:function(t){return t.data?{name:t.data[0],data:t.data[1]}:{}}},{key:"_connect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.shouldReconnect=!0;var e=null;if("default"===t)e=this._findCurrentServer();else if("next"===t)e=this._findNextAvailableServer();else{if("prev"!==t)throw new Error("Incorrect 'server' parameter passed to connect function ".concat(t,". Should be 'default' or 'next'"));e=this._findMaxPriorityServer()}e&&(this._initSocketConnection(),this._initSocketEvents(),this._initKeepAlive(),"default"!==t&&this.login())}},{key:"_checkInit",value:function(){if(!this.connectionEstablished)throw new Error('Make sure you call "sdk.init()" before doing other operations.')}},{key:"_initSocketConnection",value:function(){var e=this.server.Domain,n=this.options.protocol,o="".concat(n,"://").concat(e);this.Logger.log("Connecting to..",o),this.closeAllConnections(),this.socket=t(o,l({},this.options,{debug:!1})),W.push(this.socket),this.connectionEstablished=!0}},{key:"_initSocketEvents",value:function(){this.socket.on(h.RECONNECT_ATTEMPT,this._onReconnectAttempt.bind(this)),this.socket.on(h.RECONNECT_FAILED,this._onReconnectFailed.bind(this)),this.socket.on(h.CONNECT,this._onConnect.bind(this)),this.socket.on(h.DISCONNECT,this._onDisconnect.bind(this)),this.socket.on(h.CONNECT_ERROR,this._onConnectError.bind(this)),this.socket.on(h.CONNECT_TIMEOUT,this._onConnectTimeout.bind(this)),this.socket.on(h.KEEP_ALIVE_RESPONSE,this._onKeepAlive.bind(this)),this.socket.onevent=this._onEvent.bind(this)}},{key:"_initKeepAlive",value:function(){var t=this;setTimeout(function(){t.socket?(t.emit(h.KEEP_ALIVE,t.options.token),t._connect("prev")):t._initSocketConnection()},this.options.keepAliveTimeout)}},{key:"_findCurrentServer",value:function(){var t=null;if(this.servers.length&&(t=this.servers[0]),this.server=t,!this.server)throw new Error("Could not find any server to establish connection with");return this.server}},{key:"_findNextAvailableServer",value:function(){var t=this.server.Priority;if(this.Logger.log("Failover -> Trying to find another server"),t>0){var e=t-1,n=this.servers.find(function(t){return t.Priority===e});if(!n&&!(n=this._findMaxPriorityServer()))return;if(this.server.Domain!==n.Domain)return this.server=n,this.server;this.Logger.log("Failover -> Found new server. Connecting to it...",this.server)}return null}},{key:"_findMaxPriorityServer",value:function(){this.Logger.log("Fallback -> Trying to find previous server","_findMaxPriorityServer");var t,e,n,o=(t=this.servers,e=null,n=-1,t.forEach(function(t){t.Priority>n&&(n=t.Priority,e=t)}),e);return this.server&&o.Domain!==this.server.Domain?(this.server=o,this.Logger.log("Fallback -> Trying to find previous server",this.server),this.server):null}},{key:"_getServers",value:function(){var t=i(o.mark(function t(){var e;return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("".concat(this.options.url,"/").concat(this.options.token));case 3:return e=t.sent,t.next=6,e.json();case 6:this.servers=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),this.servers=f;case 12:case"end":return t.stop()}},t,this,[[0,9]])}));return function(){return t.apply(this,arguments)}}()},{key:"_onEvent",value:function(t){if(t.data){var e=this._parsePacket(t);this.Logger.log("New event -> ".concat(e.name),e),this._listenersMap.forEach(function(t,n){"*"===n?t(e):e.name===n&&t(e)})}}},{key:"init",value:function(){var t=i(o.mark(function t(){return o.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.connectionEstablished){t.next=2;break}return t.abrupt("return",!0);case 2:return this.socket&&this.emit(h.CLOSE),t.next=5,this._getServers();case 5:return this._connect(),this._initReconnectDelays(),t.abrupt("return",!0);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"setToken",value:function(t){this.options.token=t}},{key:"closeAllConnections",value:function(){W.forEach(function(t){t.close()}),W=[]}},{key:"disconnect",value:function(){this.shouldReconnect=!1,this._listenersMap=new Map,this.closeAllConnections()}},{key:"on",value:function(t,e){this._listenersMap.set(t,e),this._checkInit()}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkInit(),this.Logger.log("EMIT -> ".concat(t),e),this.socket.emit(t,e)}},{key:"login",value:function(){var t=this;this._checkInit();var e=!1;return new Promise(function(n,o){t.on(h.LOGIN,function(t){e=!0,n(t)}),t.emit("login",{token:t.options.token}),t.socket.on(h.ERROR,function(t){e||o(t)})})}}]),e}();return"undefined"!=typeof window&&(window.EventsSDK=Y),Y});
//# sourceMappingURL=voicenter-events-sdk.umd.js.map
